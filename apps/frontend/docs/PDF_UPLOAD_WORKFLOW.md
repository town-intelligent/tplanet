# PDF ä¸Šå‚³èˆ‡è™•ç†å®Œæ•´æµç¨‹

## ğŸ“Š å…©éšæ®µæ¶æ§‹

PDF å¾ä¸Šå‚³åˆ°ç™¼ä½ˆ CMS åˆ†ç‚ºå…©å€‹ç¨ç«‹éšæ®µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç¬¬ä¸€éšæ®µï¼šä¸Šå‚³ PDF                            â”‚
â”‚                     (DropzonePane çµ„ä»¶è² è²¬)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ä½¿ç”¨è€…æ‹–æ›³ PDF æª”æ¡ˆ                                               â”‚
â”‚ 2. å»ºç«‹ FormData                                                    â”‚
â”‚ 3. POST /api/sessions/{sid}/upload                                 â”‚
â”‚ 4. æª”æ¡ˆä¸Šå‚³åˆ° LLMTwins æœå‹™å™¨                                        â”‚
â”‚ 5. å–å¾—æª”æ¡ˆ ID                                                       â”‚
â”‚ 6. è§¸ç™¼ onUploaded(row) callback                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬äºŒéšæ®µï¼šè™•ç†å·²ä¸Šå‚³çš„ PDF                         â”‚
â”‚                     (UploadModule çµ„ä»¶è² è²¬)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. å‘¼å« processPdfAndPublishToCms()                                â”‚
â”‚ 8. POST /api/sessions/{sid}/pipeline/one_click                     â”‚
â”‚                                                                     â”‚
â”‚    å¾Œç«¯è‡ªå‹•è™•ç†ï¼ˆLLMTwinsï¼‰ï¼š                                         â”‚
â”‚    â”œâ”€ OCR æ–‡å­—è¾¨è­˜                                                  â”‚
â”‚    â”œâ”€ LLM æ¬„ä½æŠ½å–ï¼ˆè¨ˆåŠƒåç¨±ã€å–®ä½ã€ç†å¿µã€SDGsï¼‰                     â”‚
â”‚    â”œâ”€ çµ„æˆ CMS API payload                                         â”‚
â”‚    â””â”€ ç™¼ä½ˆåˆ° CMS ç³»çµ±                                               â”‚
â”‚                                                                     â”‚
â”‚ 9. å›å‚³ { uuid, cmsLink }                                          â”‚
â”‚10. é¡¯ç¤ºå°ˆæ¡ˆæ‘˜è¦çµ¦ä½¿ç”¨è€…                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” è©³ç´°æµç¨‹è§£æ

### éšæ®µä¸€ï¼šä¸Šå‚³ PDF åˆ°æœå‹™å™¨

**è² è²¬çµ„ä»¶ï¼š** [DropzonePane.jsx](../src/pages/components/DropzonePane.jsx)

**è§¸ç™¼æ™‚æ©Ÿï¼š** ä½¿ç”¨è€…æ‹–æ›³æˆ–é¸æ“‡æª”æ¡ˆ

**é—œéµä»£ç¢¼ï¼š**
```javascript
// line 56-59
const res = await fetch(`${API_LLMTWINS}/api/sessions/${sid}/upload`, {
  method: "POST",
  body: form  // FormData with PDF file
});
```

**åšäº†ä»€éº¼ï¼š**
1. å»ºç«‹ `FormData` ä¸¦é™„åŠ  PDF æª”æ¡ˆ
2. ç™¼é€ `POST` è«‹æ±‚åˆ° `/api/sessions/{sessionId}/upload`
3. æª”æ¡ˆè¢«ä¸Šå‚³åˆ° LLMTwins æœå‹™å™¨ä¸¦å„²å­˜
4. å›å‚³æª”æ¡ˆè³‡è¨Š `{ name, size }`

**è¼¸å‡ºï¼š**
```javascript
{
  id: 1733300000000.123,     // å‰ç«¯ç”Ÿæˆçš„è‡¨æ™‚ ID
  name: "è¨ˆåŠƒæ›¸.pdf",
  size: 1024000
}
```

**Callbackï¼š**
```javascript
onUploaded(row);  // è§¸ç™¼ç¬¬äºŒéšæ®µ
```

---

### éšæ®µäºŒï¼šè™•ç† PDF ä¸¦ç™¼ä½ˆåˆ° CMS

**è² è²¬çµ„ä»¶ï¼š** [UploadModule.jsx](../src/pages/backend/modules/UploadModule.jsx)

**è§¸ç™¼æ™‚æ©Ÿï¼š** æ”¶åˆ° `onUploaded` callback

**é—œéµä»£ç¢¼ï¼š**
```javascript
// line 86-88
const { uuid, cmsLink } = await processPdfAndPublishToCms({
  sessionId: sid,
  fileId: row.id,  // ä½¿ç”¨ç¬¬ä¸€éšæ®µçš„æª”æ¡ˆ ID
  onProgress: ({ stage, pct, message }) => { ... }
});
```

**åšäº†ä»€éº¼ï¼š**
1. å‘¼å«å¾Œç«¯ APIï¼š`POST /api/sessions/{sessionId}/pipeline/one_click`
2. å¾Œç«¯è‡ªå‹•åŸ·è¡Œå®Œæ•´æµç¨‹ï¼š
   - **OCR æ–‡å­—è¾¨è­˜**ï¼šå¾ PDF æå–æ–‡å­—
   - **LLM æ¬„ä½æŠ½å–**ï¼š
     - è¨ˆåŠƒåç¨± (name)
     - å–®ä½åç¨± (org)
     - ç†å¿µç°¡è¿° (philosophy)
     - æ°¸çºŒç™¼å±•æŒ‡æ¨™ (SDGs)
   - **çµ„æˆ CMS Payload**ï¼šå°‡æŠ½å–çµæœè½‰æ›ç‚º CMS æ ¼å¼
   - **ç™¼ä½ˆåˆ° CMS**ï¼šå»ºç«‹å°ˆæ¡ˆä¸¦å–å¾—é€£çµ

**è¼¸å‡ºï¼š**
```javascript
{
  uuid: "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  cmsLink: "https://cms.example.com/content/a1b2c3d4..."
}
```

---

## ğŸ¯ ç‚ºä»€éº¼è¦åˆ†å…©éšæ®µï¼Ÿ

### è¨­è¨ˆå„ªå‹¢

1. **é—œæ³¨é»åˆ†é›¢ï¼ˆSeparation of Concernsï¼‰**
   - `DropzonePane`ï¼šåªè² è²¬æª”æ¡ˆä¸Šå‚³ï¼ˆUI äº¤äº’ï¼‰
   - `UploadModule`ï¼šåªè² è²¬æ¥­å‹™é‚è¼¯ï¼ˆOCRã€LLMã€CMSï¼‰

2. **å¯é‡ç”¨æ€§ï¼ˆReusabilityï¼‰**
   - `DropzonePane` å¯ä»¥ç”¨æ–¼å…¶ä»–æª”æ¡ˆä¸Šå‚³å ´æ™¯
   - è™•ç†é‚è¼¯å¯ä»¥ç¨ç«‹æ¸¬è©¦å’Œä¿®æ”¹

3. **éŒ¯èª¤è™•ç†åˆ†å±¤**
   - ä¸Šå‚³å¤±æ•— â†’ DropzonePane è™•ç†
   - è™•ç†å¤±æ•— â†’ UploadModule è™•ç†

4. **é€²åº¦é¡¯ç¤ºæ›´ç²¾ç¢º**
   - ç¬¬ä¸€éšæ®µï¼š0-20% (ä¸Šå‚³ä¸­)
   - ç¬¬äºŒéšæ®µï¼š20-100% (OCR â†’ LLM â†’ CMS)

---

## ğŸ“‚ ç›¸é—œæª”æ¡ˆ

| æª”æ¡ˆ | è·è²¬ | é—œéµå‡½å¼ |
|------|------|---------|
| [DropzonePane.jsx](../src/pages/components/DropzonePane.jsx) | ä¸Šå‚³ PDF åˆ°æœå‹™å™¨ | `onDrop` |
| [UploadModule.jsx](../src/pages/backend/modules/UploadModule.jsx) | è™•ç† PDF ä¸¦ç™¼ä½ˆ CMS | `onUploaded` |
| [usePdfToCmsWorkflow.js](../src/pages/backend/hooks/usePdfToCmsWorkflow.js) | å°è£è™•ç† API å‘¼å« | `processPdfAndPublishToCms` |

---

## ğŸ”„ å®Œæ•´å‘¼å«éˆ

```javascript
ä½¿ç”¨è€…æ‹–æ›³ PDF
  â†“
DropzonePane.onDrop()
  â†“
fetch(POST /upload)  â† ç¬¬ä¸€éšæ®µï¼šä¸Šå‚³æª”æ¡ˆ
  â†“
onUploaded(row)
  â†“
UploadModule.onUploaded()
  â†“
processPdfAndPublishToCms()
  â†“
fetch(POST /one_click)  â† ç¬¬äºŒéšæ®µï¼šè™•ç†æª”æ¡ˆ
  â†“
å¾Œç«¯è‡ªå‹•åŸ·è¡Œï¼š
  - OCR è¾¨è­˜
  - LLM æŠ½å–
  - çµ„æˆ Payload
  - ç™¼ä½ˆ CMS
  â†“
å›å‚³ { uuid, cmsLink }
  â†“
é¡¯ç¤ºå°ˆæ¡ˆæ‘˜è¦
```

---

## ğŸ’¡ å¸¸è¦‹èª¤è§£

### âŒ éŒ¯èª¤ç†è§£
> `processPdfAndPublishToCms` æœƒä¸Šå‚³æª”æ¡ˆ

### âœ… æ­£ç¢ºç†è§£
> `processPdfAndPublishToCms` åªæ˜¯å‘Šè¨´å¾Œç«¯ã€Œå»è™•ç†å·²ç¶“ä¸Šå‚³çš„æª”æ¡ˆï¼ˆfileIdï¼‰ã€

**çœŸæ­£ä¸Šå‚³æª”æ¡ˆçš„æ˜¯ï¼š** `DropzonePane` çµ„ä»¶çš„ `fetch` å‘¼å«

---

## ğŸ“ API ç«¯é»ç¸½çµ

### 1. ä¸Šå‚³ç«¯é»
```
POST /api/sessions/{sessionId}/upload
Content-Type: multipart/form-data

Request Body:
  file: <binary PDF data>

Response:
{
  "name": "è¨ˆåŠƒæ›¸.pdf",
  "size": 1024000
}
```

### 2. è™•ç†ç«¯é»
```
POST /api/sessions/{sessionId}/pipeline/one_click
Content-Type: application/json

Request Body:
{
  "file_id": "1733300000000.123"
}

Response:
{
  "uuid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "cms_link": "https://cms.example.com/content/a1b2c3d4..."
}
```

---

**æ–‡æª”ç‰ˆæœ¬ï¼š** v1.0
**æœ€å¾Œæ›´æ–°ï¼š** 2025-12-04
**ç¶­è­·è€…ï¼š** Claude Code
